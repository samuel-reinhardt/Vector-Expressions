/**
 * @property registrations — force eager computation of inherited values.
 *
 * Without @property, `--ve-ctx-fs: 1em` is stored as the string "1em" and
 * resolved lazily at the point of USE. When ::before (inside the mark with
 * font-size:0) reads var(--ve-ctx-fs), the 1em resolves against 0 → 0px.
 *
 * @property { syntax: '<length>' } makes the browser resolve 1em at the
 * DECLARING element's font-size (e.g. 32px on an h1). The token inherits
 * the computed 32px, and ::before correctly renders at that size.
 *
 * Same principle for --ve-ctx-color with currentColor.
 */
@property --ve-ctx-fs {
	syntax:        "<length>";
	inherits:      true;
	initial-value: 16px;
}

@property --ve-ctx-color {
	syntax:        "<color>";
	inherits:      true;
	initial-value: #000;
}

/* =============================================================================
   Vector Expressions — Block Editor Styles
   ============================================================================= */

/**
 * Design tokens — scoped to the WP editor so they do not leak to the frontend.
 */
.editor-styles-wrapper {
	--ve-upsell-bg:      #eaf7f1;
	--ve-upsell-border:  #5df4a3;
	--ve-upsell-padding: 10px;
	--ve-font-sm:        12px;
	--ve-locked-opacity: 0.6;
	--ve-logo-size:      16px;
}

/**
 * Panel title — logo + label inline.
 */
.ve-panel-title {
	display: inline-flex;
	align-items: center;
	gap: 10px;
}

/**
 * Section dividers — VISIBILITY / DYNAMIC CLASS grouping.
 *
 * `.ve-section` adds consistent vertical rhythm between control groups.
 * `.ve-section--bordered` adds a top separator to visually distinguish
 * the Dynamic Class section from the Visibility group above it.
 */
.ve-section {
	padding-bottom: 4px;
}

.ve-section--bordered {
	padding-top: 16px;
	margin-top: 8px;
	border-top: 1px solid #e0e0e0;
}

/**
 * Section label — small uppercase category header, matching WP's
 * ToolsPanel and similar grouping patterns in the block editor.
 */
.ve-section-label {
	margin: 0 0 10px;
	font-size: 10px;
	font-weight: 500;
	text-transform: uppercase;
	letter-spacing: 0.06em;
	color: #757575;
}

.ve-logo {
	width:       var( --ve-logo-size );
	height:      var( --ve-logo-size );
	flex-shrink: 0;
}

/**
 * Locked panel — used for Pro-gated UI sections.
 * Greys out and disables pointer interaction on non-Pro installs.
 */
.ve-locked-panel {
	opacity: var( --ve-locked-opacity );
	pointer-events: none;
	filter: grayscale( 100% );
}

/**
 * Upsell notice — displayed beneath locked panels when Pro is not active.
 */
.ve-upsell {
	margin-top: var( --ve-upsell-padding );
	padding: var( --ve-upsell-padding );
	background: var( --ve-upsell-bg );
	border-left: 4px solid var( --ve-upsell-border );
	font-size: var( --ve-font-sm );
}

.ve-upsell a {
	text-decoration: none;
	font-weight: bold;
}

/**
 * Syntax reference toggle + table — now lives inside .ve-section,
 * so top border/padding replaces the former standalone separator.
 */
.ve-syntax-ref-wrap {
	margin-top: 10px;
}

.ve-syntax-ref-toggle {
	font-size: var( --ve-font-sm );
	color: #757575;
	text-decoration: none !important;
	padding: 0 !important;
}

.ve-syntax-ref {
	width: 100%;
	border-collapse: collapse;
	font-size: var( --ve-font-sm );
	margin-top: 6px;
}

.ve-syntax-ref td,
.ve-syntax-ref th {
	padding: 3px 4px;
	text-align: left;
	vertical-align: middle;
}

.ve-syntax-ref td:first-child {
	width: 55%;
	white-space: nowrap;
}

.ve-syntax-ref code {
	font-size: 11px;
	background: #f0f0f0;
	padding: 1px 4px;
	border-radius: 3px;
}

.ve-ref-head th {
	padding-top: 8px;
	font-size: 10px;
	text-transform: uppercase;
	letter-spacing: 0.04em;
	color: #999;
}

/**
 * Parent-context capture for token pseudo-element rendering.
 *
 * font-size:0 on the token element hides the inner {{ expr }} storage text,
 * but ::before inherits that 0 — making em units useless there. The trick:
 * declare --ve-ctx-fs and --ve-ctx-color on *every element except the token
 * itself*. Because .ve-expr-token is excluded, it inherits the parent's
 * already-computed values (e.g. 32px on an <h1>, white inside a dark block)
 * rather than re-evaluating them against its own font-size:0 / color.
 */
.editor-styles-wrapper *:not( .ve-expr-token ) {
	--ve-ctx-fs:    1em;          /* resolves at each element's own size */
	--ve-ctx-color: currentColor; /* resolves at each element's own color */
}

/**
 * Expression token — context-integrated inline indicator.
 *
 * Appears as plain text at the surrounding font size and color, marked only
 * by a dotted brand-green underline so it reads naturally in any context
 * (headings, body copy, dark/light blocks) without imposing a fixed size
 * or obtrusive badge chrome.
 *
 * font-size:0 erases the inner {{ expr }} storage text from the layout.
 * ::before re-renders the view value at the captured parent size/color.
 */
.ve-expr-token {
	/* Erase badge chrome */
	background:    transparent;
	border:        none;
	border-radius: 0;
	padding:       0;
	box-shadow:    none;

	/* Inherit typographic context (except size — handled via ::before) */
	font-family: inherit;
	font-weight: inherit;
	font-style:  inherit;
	color: inherit!important;

	/* Hide the inner {{ expr }} storage text */
	font-size: 0;

	/* Layout */
	display:        inline-block;
	vertical-align: baseline;
	white-space:    nowrap;
	cursor:         pointer!important;
}

.ve-expr-token::before {
	content: attr( data-ve-view );

	/* Restore parent size and color via the captured custom properties */
	font-size: var( --ve-ctx-fs,    1rem );

	/* Keep surrounding typographic context */
	font-family: inherit;
	font-weight: inherit;
	font-style:  inherit;
	line-height: normal;

	/* Brand-green dotted underline — the dynamic indicator */
	text-decoration:           underline dotted hsl( 147 65% 42% );
	text-underline-offset:     0.2em;
	text-decoration-thickness: 2px;
}

/*
 * Placeholder: shown when view is absent or empty (no [data-ve-view] attr).
 * Shown before PHP hydrate_editor_previews() injects the live value.
 */
.ve-expr-token:not([data-ve-view])::before,
.ve-expr-token[data-ve-view=""]::before {
	content:    '⚡ Dynamic';
	opacity:    0.55;
	font-style: italic;
}

/*
 * [data-ve-empty] is set by JS Pass-2 when the expression resolved to a
 * visually-empty value: boolean false → "", 0 → "0", whitespace-only, etc.
 * The chip must still be visible and selectable so the user can find and
 * edit or delete it.
 */
.ve-expr-token[data-ve-empty]::before {
	content:     '⚡ Dynamic';
	opacity:     0.55;
	font-style:  italic;
	/* Ensure minimum width so a zero-content token is never invisible */
	min-width:   4ch;
	display:     inline-block;
}

/* Hover: signal interactivity by solidifying the underline */
.ve-expr-token:hover::before {
	text-decoration-style: solid;
	text-decoration-color: #5df4a3;
	outline-width: 0!important;
	outline-style: solid!important;
	transition: outline 0.2s ease-in-out;
}

/**
 * Active / cursor-on-token state.
 *
 * [data-ve-active] is managed by our useEffect (reliable, toggles with isActive).
 * [data-rich-text-format-boundary] is Gutenberg's native attribute (kept as
 * fallback but we clean it up when isActive=false to prevent persistence).
 */
.ve-expr-token[data-ve-active]::before,
.ve-expr-token[data-rich-text-format-boundary]::before {
	outline:      	2px solid #5df4a3!important;
	outline-offset: 2px;
	border-radius:  2px;
	text-decoration-style: solid;
}

/**
 * Popover expression editor.
 */

/* Make the TextControl input visually stronger — higher contrast text + border */
.ve-pill-popover .components-text-control__input {
	background: #fff;
	color: #1e1e1e;
	border: 1.5px solid #949494;
	border-radius: 4px;
	font-size: 13px;
	font-family: ui-monospace, 'SFMono-Regular', Consolas, monospace;
	padding: 6px 10px;
}
.ve-pill-popover .components-text-control__input:focus {
	border-color: #5df4a3;
	box-shadow: 0 0 0 1.5px #5df4a3;
	outline: none;
}

/* Brand styling for the primary apply button */
.ve-pill-popover .components-button.is-primary {
	background: #5df4a3;
	color: #0b4a26;
	border-color: #5df4a3;
	transition: background 0.1s, border-color 0.1s;
}
.ve-pill-popover .components-button.is-primary:hover,
.ve-pill-popover .components-button.is-primary:focus {
	background: #4de695;
	color: #0b4a26;
	border-color: #4de695;
}

/**
 * Autocomplete dropdown option — structural alignment.
 */
.ve-autocompleter-option {
	display: flex;
	align-items: center;
	width: 320px;
}

/* Override WordPress's aggressive blue highlight with our brand green */
.components-autocomplete__results .components-autocomplete__option:has(.ve-autocompleter-option).is-active,
.components-autocomplete__results .components-autocomplete__result:has(.ve-autocompleter-option).is-selected {
    background-color: rgb(93, 244, 163) !important;
    color: black !important;
}
.components-autocomplete__results .components-autocomplete__option:has(.ve-autocompleter-option).is-active code,
.components-autocomplete__results .components-autocomplete__option:has(.ve-autocompleter-option).is-active .ve-ac-icon svg path,
.components-autocomplete__results .components-autocomplete__option:has(.ve-autocompleter-option).is-active .ve-ac-icon svg circle,
.components-autocomplete__results .components-autocomplete__result:has(.ve-autocompleter-option).is-selected code,
.components-autocomplete__results .components-autocomplete__result:has(.ve-autocompleter-option).is-selected .ve-ac-icon svg path,
.components-autocomplete__results .components-autocomplete__result:has(.ve-autocompleter-option).is-selected .ve-ac-icon svg circle {
    color: black!important;
}

/* Allow text truncation within the autocompleter flex row and expand the hover box */
.components-autocomplete__results .components-button:has(.ve-autocompleter-option) {
	width: 320px;
	padding: 8px 12px;
}

/* ── Popover suggestion chips ─────────────────────────────────────────────── */

/* Wrapping chip grid — max 3 rows before scrolling. */
.ve-pill-suggestions {
	display: flex;
	flex-wrap: wrap;
	gap: 4px;
	max-height: 90px;
	overflow-y: auto;
	overflow-x: hidden;
	padding: 4px 0 2px;
	margin: 0 0 8px;
	scrollbar-width: thin;
}

/* Base chip */
.ve-pill-suggestion-btn {
	display: inline-flex;
	align-items: center;
	gap: 5px;
	padding: 3px 9px;
	border-radius: 10px;
	border: 1px solid #d0d5d8;
	background: #f6f7f7;
	color: #1e1e1e;
	font-size: 11.5px;
	line-height: 1.5;
	white-space: nowrap;
	cursor: pointer;
	transition: background 0.1s, border-color 0.1s;
}
.ve-pill-suggestion-btn:hover,
.ve-pill-suggestion-btn:focus-visible {
	background: #eaf7f1;
	border-color: #39b074;
	outline: none;
}

/* Text label inside any chip */
.ve-pill-suggestion-label {
	font-size: 11.5px;
	color: #1e1e1e;
}

/* Monospace expression shown inside non-root, non-pattern chips */
.ve-pill-suggestion-expr {
	font-size: 10px;
	opacity: 0.6;
	font-family: monospace;
}

/* Root entry-point chip — slightly heavier with SVG icon */
.ve-pill-suggestion-btn--root {
	padding: 4px 10px;
	border-radius: 8px;
	font-weight: 500;
	border-color: #c3d9ce;
	background: #f0faf5;
}
.ve-pill-suggestion-btn--root:hover {
	background: #ddf5ea;
	border-color: #39b074;
}

/* SVG icon in root chips — fix size and vertical alignment */
.ve-pill-suggestion-icon {
	display: inline-flex;
	align-items: center;
	line-height: 0;
}
.ve-pill-suggestion-icon svg {
	width: 14px;
	height: 14px;
	vertical-align: middle;
}

/* Pattern chips — subtle pink/rose tint to distinguish from data chips */
.ve-pill-suggestion-btn--pattern {
	background: #fdf2f8;
	border-color: #f0c4e0;
	color: #7a1548;
}
.ve-pill-suggestion-btn--pattern .ve-pill-suggestion-label {
	color: #7a1548;
}
.ve-pill-suggestion-btn--pattern:hover {
	background: #fce7f3;
	border-color: #d946a8;
	color: #6b1040;
}

/* Layout utility — replaces inline style spacer divs */
.ve-spacer {
	height: 5px;
}

/* ── Dynamic Class textarea ───────────────────────────────────────────────── */

.ve-class-field {
	margin-bottom: 0;
}

.ve-class-field .components-base-control__label {
	display: block;
	margin-bottom: 4px;
}

.ve-class-field .components-base-control__help {
	margin-top: 6px;
	font-size: 11px;
	color: #757575;
}

/**
 * Code-block treatment: light gray background + neutral border signals
 * "this is a template expression field", visually distinct from plain
 * text inputs while staying within the WP editor palette.
 */
.ve-class-textarea {
	display: block;
	width: 100%;
	min-height: 36px;
	padding: 6px 8px;
	font-size: 12.5px;
	font-family: ui-monospace, 'SFMono-Regular', Consolas, monospace;
	line-height: 1.6;
	color: #1e1e1e;
	background: #f6f8fa;
	border: 1px solid #d0d7de;
	border-radius: 4px;
	resize: none;
	overflow: hidden;
	box-sizing: border-box;
	transition: border-color 0.1s, box-shadow 0.1s, background 0.1s;
}

.ve-class-textarea:focus {
	border-color: #007cba;
	box-shadow: 0 0 0 1.5px #007cba;
	outline: none;
	background: #fff;
}

.ve-class-textarea::placeholder {
	color: #a0adb8;
	font-style: italic;
}
